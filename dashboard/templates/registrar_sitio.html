<!DOCTYPE html>
<html>
<head>
    <title>Registrar Sitio Turístico</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="mb-4">Registrar Sitio Turístico</h2>

    <div class="card shadow-sm p-4">
        <form method="POST" class="row g-3">
            {% csrf_token %}

            {% for field in form %}
                <div class="col-md-6">
                    <label class="form-label fw-semibold">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                        <div class="text-danger small">{{ field.errors }}</div>
                    {% endif %}
                </div>
            {% endfor %}

            <div class="col-12 mt-4">
                <label class="form-label fw-semibold">Seleccionar ubicación en el mapa</label>
                <div id="map" style="height: 350px; border-radius: 10px;"></div>
            </div>


            <div class="col-12 mt-3">
                <button class="btn btn-primary" type="submit">Guardar</button>
                <a href="{% url 'index' %}?view=listar" class="btn btn-secondary">Volver</a>
            </div>
        </form>
    </div>
</div>

    <script>
        document.querySelectorAll("input, select, textarea").forEach(el => {
            el.classList.add("form-control");
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // Coordenadas por defecto (Popayán)
            const DEFAULT_LAT = 2.4485;
            const DEFAULT_LNG = -76.6073;

            // Crear mapa
            const map = L.map('map').setView([DEFAULT_LAT, DEFAULT_LNG], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
            }).addTo(map);

            let marker = null;

            // Obtener inputs del formulario
            const latInput = document.getElementById("id_latitud");
            const lngInput = document.getElementById("id_longitud");

            // Si ya tienen valores, mostrar marcador inicial
            if (latInput.value && lngInput.value) {
                const lat = parseFloat(latInput.value);
                const lng = parseFloat(lngInput.value);

                marker = L.marker([lat, lng]).addTo(map);
                map.setView([lat, lng], 15);
            }

            // Evento click en el mapa
            map.on('click', function (e) {
                const lat = e.latlng.lat.toFixed(6);
                const lng = e.latlng.lng.toFixed(6);

                // Colocar valores en los inputs
                latInput.value = lat;
                lngInput.value = lng;

                // Mover o crear marcador
                if (marker) {
                    marker.setLatLng(e.latlng);
                } else {
                    marker = L.marker(e.latlng).addTo(map);
                }
            });

        });
    </script>

</body>

</html>
